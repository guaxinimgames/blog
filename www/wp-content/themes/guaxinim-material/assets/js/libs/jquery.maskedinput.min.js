(function(g){function d(){var i=document.createElement("input"),a="onpaste";return i.setAttribute(a,""),"function"==typeof i[a]?"paste":"input"}var j,b=d()+".mask",f=navigator.userAgent,c=/iphone/i.test(f),h=/android/i.test(f);g.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn",placeholder:"_"},g.fn.extend({caret:function(i,a){var k;if(0!==this.length&&!this.is(":hidden")){return"number"==typeof i?(a="number"==typeof a?a:i,this.each(function(){this.setSelectionRange?this.setSelectionRange(i,a):this.createTextRange&&(k=this.createTextRange(),k.collapse(!0),k.moveEnd("character",a),k.moveStart("character",i),k.select())})):(this[0].setSelectionRange?(i=this[0].selectionStart,a=this[0].selectionEnd):document.selection&&document.selection.createRange&&(k=document.selection.createRange(),i=0-k.duplicate().moveStart("character",-100000),a=i+k.text.length),{begin:i,end:a})}},unmask:function(){return this.trigger("unmask")},mask:function(i,n){var p,a,m,e,o,k;return !i&&this.length>0?(p=g(this[0]),p.data(g.mask.dataName)()):(n=g.extend({placeholder:g.mask.placeholder,completed:null},n),a=g.mask.definitions,m=[],e=k=i.length,o=null,g.each(i.split(""),function(q,l){"?"==l?(k--,e=q):a[l]?(m.push(RegExp(a[l])),null===o&&(o=m.length-1)):m.push(null)}),this.trigger("unmask").each(function(){function z(v){for(;k>++v&&!m[v];){}return v}function w(v){for(;--v>=0&&!m[v];){}return v}function q(y,x){var E,v;if(!(0>y)){for(E=y,v=z(x);k>E;E++){if(m[E]){if(!(k>v&&m[E].test(t[v]))){break}t[E]=t[v],t[v]=n.placeholder,v=z(v)}}B(),C.caret(Math.max(o,y))}}function l(E){var y,F,v,x;for(y=E,F=n.placeholder;k>y;y++){if(m[y]){if(v=z(y),x=t[y],t[y]=F,!(k>v&&m[v].test(x))){break}F=x}}}function u(E){var x,F,v,y=E.which;8===y||46===y||c&&127===y?(x=C.caret(),F=x.begin,v=x.end,0===v-F&&(F=46!==y?w(F):v=z(F-1),v=46===y?z(v):v),r(F,v),q(F,v-1),E.preventDefault()):27==y&&(C.val(s),C.caret(0,A()),E.preventDefault())}function D(F){var G,x,E,v=F.which,y=C.caret();F.ctrlKey||F.altKey||F.metaKey||32>v||v&&(0!==y.end-y.begin&&(r(y.begin,y.end),q(y.begin,y.end-1)),G=z(y.begin-1),k>G&&(x=String.fromCharCode(v),m[G].test(x)&&(l(G),t[G]=x,B(),E=z(G),h?setTimeout(g.proxy(g.fn.caret,C,E),0):C.caret(E),n.completed&&E>=k&&n.completed.call(C))),F.preventDefault())}function r(x,v){var y;for(y=x;v>y&&k>y;y++){m[y]&&(t[y]=n.placeholder)}}function B(){C.val(t.join(""))}function A(E){var y,F,v=C.val(),x=-1;for(y=0,pos=0;k>y;y++){if(m[y]){for(t[y]=n.placeholder;pos++<v.length;){if(F=v.charAt(pos-1),m[y].test(F)){t[y]=F,x=y;break}}if(pos>v.length){break}}else{t[y]===v.charAt(pos)&&y!==e&&(pos++,x=y)}}return E?B():e>x+1?(C.val(""),r(0,k)):(B(),C.val(C.val().substring(0,x+1))),e?y:o}var C=g(this),t=g.map(i.split(""),function(v){return"?"!=v?a[v]?n.placeholder:v:void 0}),s=C.val();C.data(g.mask.dataName,function(){return g.map(t,function(x,v){return m[v]&&x!=n.placeholder?x:null}).join("")}),C.attr("readonly")||C.one("unmask",function(){C.unbind(".mask").removeData(g.mask.dataName)}).bind("focus.mask",function(){clearTimeout(j);var v;s=C.val(),v=A(),j=setTimeout(function(){B(),v==i.length?C.caret(0,v):C.caret(v)},10)}).bind("blur.mask",function(){A(),C.val()!=s&&C.change()}).bind("keydown.mask",u).bind("keypress.mask",D).bind(b,function(){setTimeout(function(){var v=A(!0);C.caret(v),n.completed&&v==C.val().length&&n.completed.call(C)},0)}),A()}))}})})(jQuery);